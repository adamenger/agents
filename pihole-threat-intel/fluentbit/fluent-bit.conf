[SERVICE]
    Flush         5
    Daemon        Off
    Log_Level     info
    Parsers_File  /fluent-bit/etc/parsers.conf
    HTTP_Server   On
    HTTP_Listen   0.0.0.0
    HTTP_Port     2020

# Pi-hole query log (v5 dnsmasq format)
# Note: Pi-hole v6 changed the log format. If using v6, the FTL database
# (SQLite) is the recommended data source â€” use data_source=sqlite instead.
[INPUT]
    Name          tail
    Path          /pihole-log/pihole.log
    Tag           pihole.queries
    Parser        pihole
    Refresh_Interval 5
    Mem_Buf_Limit 5MB

# Pi-hole FTL log
[INPUT]
    Name          tail
    Path          /pihole-log/FTL.log
    Tag           pihole.ftl
    Parser        pihole_ftl
    Refresh_Interval 10
    Mem_Buf_Limit 5MB

# Add metadata
[FILTER]
    Name          record_modifier
    Match         pihole.*
    Record        service pihole

# Output to OpenSearch
[OUTPUT]
    Name          opensearch
    Match         pihole.*
    Host          opensearch
    Port          9200
    Suppress_Type_Name On
    Logstash_Format On
    Logstash_Prefix pihole
    Time_Key      @timestamp
    Include_Tag_Key On
    Tag_Key       tag
